#Building the next word prediction

#Load the n-gram databases 

load=("BigramData.Rds")
load=("TrigramData.Rds")
load=("DataQuadgram.Rds")
load=("UnigramData.Rds")

#Load the necessary libraries
library(stringr)
library(dplyr)
library(tm)
library(stylo)

proc1 <- function(sentence){
    
    a <- ListUnigram$unigram
    
    return(as.String(a[10]))
}
proc <- function(sentence){
    value = "..Prediction as per entered text is..."
    sen = unlist(strsplit(sentence,' '))
    if(length(sen)>=3){
        value = quadgram(sen[(length(sen)-2):length(sen)])
    }
    
    if(is.null(value)||length(sen)==2){
        value = trigram(sen[(length(sen)-1):length(sen)])
        
    }
    if(is.null(value)||length(sen)==1){
        value = bigram(sen[length(sen)])
        
    }
    if(is.null(value)){
        value = "Please try another word as unable to predict due to small sample size"
    }
    
    return(value)
}

quadgram <- function(fourg){
    four <- paste(fourg,collapse = ' ')
    foursum <- data.frame(fourgram="test",frequency=0)
    k <- ListTrigram[trigram==four]
    m <- as.numeric(k$frequency)
    if(length(m)==0) return(NULL)
    
    for(string0 in ListUnigram$unigram){
        text = paste(four,string0)
        found <- ListQuadgram[quadgram==text]
        n<- as.numeric(found$frequency)
        
        if(length(n)!=0){
            foursum <- rbind(foursum,found,use.names=FALSE, fill=TRUE)
           
        }
    }
    if(nrow(foursum)==1) return(NULL)
    foursum <- foursum[order(-frequency)]
    sen <- unlist(strsplit(as.String(foursum[1,quadgram]),' '))
    return (sen[length(sen)])
}

trigram <- function(threeg){
    three <- paste(threeg,collapse = ' ')
    threesum <- data.frame(trigram="test",frequency=0)
    k <- ListBigram[bigram==three]
    m <- as.numeric(k$frequency)
    if(length(m)==0) return(NULL)
    
    for(string0 in ListUnigram$unigram){
        text = paste(three,string0)
        found <- ListTrigram[trigram==text]
        n<- as.numeric(found$frequency)
        
        if(length(n)!=0){
            threesum <- rbind(threesum,found,use.names=FALSE, fill=TRUE)
            
        }
    }
    if(nrow(threesum)==1) return(NULL)
    threesum <- threesum[order(-frequency)]
    sen <- unlist(strsplit(as.String(threesum[1,trigram]),' '))
    return (sen[length(sen)])
}

bigram <- function(twog){
    two <- paste(twog,collapse = ' ')
    twosum <- data.frame(bigram="test",frequency=0)
    print(nrow(ListUnigram))
    k <- ListUnigram[unigram==two]
    m <- as.numeric(k$frequency)
    if(length(m)==0) return(NULL)
    
    for(string0 in ListUnigram$unigram){
        text = paste(two,string0)
        found <- ListBigram[bigram==text]
        n<- as.numeric(found$frequency)
        
        if(length(n)!=0){
            twosum <- rbind(twosum,found,use.names=FALSE, fill=TRUE)
            
        }
    }
    
    if(nrow(twosum)==1) return(NULL)
    twosum <- twosum[order(-frequency)]
    
    sen <- unlist(strsplit(as.String(twosum[1,bigram]),' '))
    return (sen[length(sen)])
}